# Обработка сбоев и отказоустойчивость

## Типы сбоев

#### 1. Network Failures (Сбои сети)
#### 2. Service Failures (Отказ сервисов)
#### 3. Dependency Failures (Отказ зависимостей)
#### 4. Cascading Failures (Каскадные сбои)

## Стратегии обработки сбоев

### 1. Circuit Breaker (Предохранитель)

Паттерн, защищающий от каскадных сбоев.

**Когда используется**:
- ✅ Для всех HTTP вызовов между микросервисами
- ✅ Для вызовов к внешним API
- ✅ Для вызовов к базе данных (опционально)

### 2. Retry Policy (Политика повторных попыток)

Автоматическое повторение failed запросов.

**Стратегии retry:**

#### Exponential Backoff (Экспоненциальная задержка)
```
Попытка 1 → Ошибка
Wait 1s
Попытка 2 → Ошибка
Wait 2s
Попытка 3 → Ошибка
Wait 4s
Попытка 4 → Успех
```

**Когда использоватся:**
- ✅ 5xx ошибки (серверные ошибки)
- ✅ Network timeouts
- ✅ Transient failures (временные сбои)

### 3. Timeout Policy (Политика таймаутов)

**Рекомендуемые таймауты:**

| Операция | Timeout | Обоснование |
|----------|---------|-------------|
| gRPC calls | 5-10s | Быстрые операции |
| REST API | 10-30s | Стандартные операции |
| Database queries | 5-15s | Сложные запросы |
| External API | 30-60s | Медленные внешние системы |

```
Client: 30s → API Gateway: 25s → Service: 20s → Database: 15s
```

### 4. Fallback Strategy (Запасная стратегия)

Альтернативное действие при сбое.

**Примеры fallback:**

#### 1. Возврат кэшированных данных
#### 2. Возврат default значения
#### 3. Degraded response (ухудшенный ответ)
#### 4. Вызов альтернативного сервиса